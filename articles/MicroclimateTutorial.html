<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating microclimates • TrenchR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating microclimates">
<meta property="og:description" content="TrenchR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TrenchR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AllometryAndConversionsTutorial.html">Allometries and conversions</a>
    </li>
    <li>
      <a href="../articles/MicroclimateTutorial.html">Estimating microclimates</a>
    </li>
    <li>
      <a href="../articles/Symbols.html">List of Symbols</a>
    </li>
    <li>
      <a href="../articles/TeTutorial.html">Using energy balances to estimate body temperatures</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/trenchproject/TrenchR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MicroclimateTutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating microclimates</h1>
                        <h4 data-toc-skip class="author">Lauren Buckley and the TrEnCh project, Department of Biology, University of Washington</h4>
            
            <h4 data-toc-skip class="date">2022-01-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/trenchproject/TrenchR/blob/HEAD/vignettes/MicroclimateTutorial.Rmd" class="external-link"><code>vignettes/MicroclimateTutorial.Rmd</code></a></small>
      <div class="hidden name"><code>MicroclimateTutorial.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">##Load TrenchR package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trenchproject/TrenchR" class="external-link">TrenchR</a></span><span class="op">)</span></code></pre></div>
<p>This tutorial covers approaches and functions for preparing environmental data for analyses such as examining organismal energy balances. The tutorial first covers estimating the intensity and partitioning of solar radiation, including estimating solar angles and day length. We then turn to estimating temperature and wind speed profiles that can scale weather station data to the conditions experienced by organisms. We review functions for modeling diurnal variation in temperature and solar radiation as well as heat accumulation (degree days). The tutorial concludes with a microclimate model for estimating soil temperatures.</p>
<div class="section level1">
<h1 id="radiation">Radiation<a class="anchor" aria-label="anchor" href="#radiation"></a>
</h1>
<div class="section level2">
<h2 id="solar-angles-and-day-length">Solar angles and day length<a class="anchor" aria-label="anchor" href="#solar-angles-and-day-length"></a>
</h2>
<p>Sun position and day length are often estimated based on the calendar date. We provide a function <code><a href="../reference/day_of_year.html">day_of_year()</a></code> that facilitates translating a date into a calendar date.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/day_of_year.html">day_of_year</a></span><span class="op">(</span><span class="st">"2017-04-22"</span>, format<span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 112</span></code></pre>
<p>We next present functions to calculate sun angles. We use the calendar date (J) to estimate solar declination (radian), which is the angular distance of the sun north or south of the earth’s equator, as follows (<code><a href="../reference/dec_angle.html">dec_angle()</a></code>): <span class="math display">\[ \delta= \arcsin[0.39795 \cos(0.21631+ 2 \arctan (0.967 \tan [0.0086(-186+J)]))].\]</span></p>
<p>The solar declination angle can be calculated in TrenchR as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/dec_angle.html">dec_angle</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"day of year"</span>, ylab<span class="op">=</span><span class="st">"declination angle (radian)"</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>Zenith angle <span class="math inline">\(\psi\)</span> (°), the location of the sun as an angle measured from vertical, can be estimated as: <span class="math display">\[\cos \psi = \sin( \delta) \sin( \phi) + \cos(\delta)\cos(\phi)\cos(\pi/12*(h-h_0)),\]</span> where <span class="math inline">\(J\)</span> is calendar date, <span class="math inline">\(\phi\)</span> is latitude (radians), <span class="math inline">\(h\)</span> is hour, and <span class="math inline">\(h_0\)</span> is the time of solar noon. We illustrate how zenith angles (°) change over the day throughout the year in Seattle, WA, USA:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, doy<span class="op">=</span><span class="fl">200</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, ylab<span class="op">=</span><span class="st">"zenith angle (°)"</span>, xlab<span class="op">=</span><span class="st">"hour"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, doy<span class="op">=</span><span class="fl">1</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, doy<span class="op">=</span><span class="fl">100</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotdash"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, doy<span class="op">=</span><span class="fl">300</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, title<span class="op">=</span><span class="st">"day of year"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"dotdash"</span>,<span class="st">"solid"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>We also examine how zenith angles (°) at noon change over the course of the year for latitudes along the longitude of Seattle, WA USA:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, hour<span class="op">=</span><span class="fl">12</span>, lat<span class="op">=</span><span class="fl">60</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"zenith angle (°)"</span>, xlab<span class="op">=</span><span class="st">"day of year"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, hour<span class="op">=</span><span class="fl">12</span>, lat<span class="op">=</span><span class="fl">40</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, hour<span class="op">=</span><span class="fl">12</span>, lat<span class="op">=</span><span class="fl">20</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotdash"</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, hour<span class="op">=</span><span class="fl">12</span>, lat<span class="op">=</span><span class="fl">0</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">zen</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, title<span class="op">=</span><span class="st">"latitude (°)"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dashed"</span>,<span class="st">"dotdash"</span>,<span class="st">"dotted"</span>,<span class="st">"solid"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>The time of solar noon (<code><a href="../reference/solar_noon.html">solar_noon()</a></code>) can be estimated as <span class="math inline">\(h_0= 12 - LC -ET\)</span>, where <span class="math inline">\(LC\)</span> in the longitude correction (+4 minutes for each degree east of the standard meridian and -4 minutes for each degree west of the standard meridian) and <span class="math inline">\(ET\)</span> is the equation of time. The <span class="math inline">\(ET\)</span> is estimated as: <span class="math display">\[ ET= \frac{-104.7\sin (f)+596.2\sin (2f)+4.3\sin (3f)-12.7\sin (4f)-429.3\cos (f)-2.0\cos (2f)+19.3\cos (3f)}{3600}, \]</span> where <span class="math inline">\(f=279.575 + 0.9856 J\)</span>, in degrees. The time of solar noon can be estimated across the year for several longitudes as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/solar_noon.html">solar_noon</a></span><span class="op">(</span>lon<span class="op">=</span><span class="fl">150</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11.3</span>,<span class="fl">12.7</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"time of solar noon (hour)"</span>, xlab<span class="op">=</span><span class="st">"day of year"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/solar_noon.html">solar_noon</a></span><span class="op">(</span>lon<span class="op">=</span><span class="fl">155</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/solar_noon.html">solar_noon</a></span><span class="op">(</span>lon<span class="op">=</span><span class="fl">145</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">12</span>,b<span class="op">=</span><span class="fl">0</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"longitude (°)"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">145</span>, <span class="fl">150</span>, <span class="fl">155</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dashed"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>The azimuth angle is the angle (in degrees) from which the sunlight is coming measured from true north or south measured in the horizontal plane. The azimuth angle (<span class="math inline">\(AZ\)</span> in degrees) is estimated with respect to due south, increasing in the counter-clockwise direction such that <span class="math inline">\(90^\circ\)</span> is east. <span class="math inline">\(AZ\)</span> can be calculated as a function of declination angle <span class="math inline">\(\delta\)</span> (°), zenith angle <span class="math inline">\(\psi\)</span> (°), and latitude <span class="math inline">\(\phi\)</span> (°) as follows: <span class="math display">\[\cos AZ= \frac{-(\sin \delta - \cos \psi \sin \phi)}{\cos \phi \sin \psi}.\]</span> TrenchR includes a function to estimate azimuth angle as follows. We first examine how azimuth angle varies across the day.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, doy<span class="op">=</span><span class="fl">173</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"hour"</span>, ylab<span class="op">=</span><span class="st">"azimuth angle (°)"</span><span class="op">)</span>
<span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, doy<span class="op">=</span><span class="fl">356</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, doy<span class="op">=</span><span class="fl">266</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, doy<span class="op">=</span><span class="fl">228</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">18</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>,lty<span class="op">=</span><span class="st">"dotdash"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>, title<span class="op">=</span><span class="st">"day of year"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">173</span>, <span class="fl">228</span>, <span class="fl">266</span>, <span class="fl">356</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotdash"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>We then examine how azimuth angle varies across the year.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, hour<span class="op">=</span><span class="fl">12</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"day of year"</span>, ylab<span class="op">=</span><span class="st">"azimuth angle (°)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">120</span><span class="op">)</span><span class="op">)</span>
<span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, hour<span class="op">=</span><span class="fl">9</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="va">az</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, FUN<span class="op">=</span><span class="va">azimuth_angle</span>, hour<span class="op">=</span><span class="fl">6</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="va">az</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"hour"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">12</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"dashed"</span>, <span class="st">"solid"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>These sun angles can be used to solve for day length. The equation for half day length <span class="math inline">\(h_s\)</span>, which is the time (in degrees) from sunrise to solar noon, is used as the basis for our <code><a href="../reference/daylength.html">daylength()</a></code> function: <span class="math display">\[ h_s= \cos^{-1}\left( \frac{\cos \psi-sin \phi \sin \delta}{\cos \phi \cos \delta} \right).\]</span> We examine how day length varies over the year for sites at several latitudes.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/daylength.html">daylength</a></span><span class="op">(</span>lat<span class="op">=</span><span class="fl">10</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">22</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"day of year"</span>, ylab<span class="op">=</span><span class="st">"day length (hour)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/daylength.html">daylength</a></span><span class="op">(</span>lat<span class="op">=</span><span class="fl">35</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fu"><a href="../reference/daylength.html">daylength</a></span><span class="op">(</span>lat<span class="op">=</span><span class="fl">60</span>, doy<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"latitude (°)"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">35</span>, <span class="fl">60</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dashed"</span>,<span class="st">"dotted"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="radiation-components">Radiation components<a class="anchor" aria-label="anchor" href="#radiation-components"></a>
</h2>
<p>We provide functions to estimate solar (shortwave) radiation by discounting incoming solar radiation due to scattering as the radiation travels through the atmosphere. The primary function <code><a href="../reference/estimate_radiation.html">estimate_radiation()</a></code> returns estimates of the direct, diffuse, and reflected components of solar radiation (<span class="math inline">\(W m^{-2}\)</span>). The radiation streams are the direct irradiance on a surface perpendicular to the beam <span class="math inline">\(S_p\)</span>, the diffuse sky irradiance on a horizontal plane <span class="math inline">\(S_d\)</span> (<span class="math inline">\(W m^{-2}\)</span>), and the reflected radiation from the ground <span class="math inline">\(S_r\)</span>. The sum of these three streams represents the total irradiance of a horizontal surface <span class="math inline">\(S_t\)</span>.</p>
<p>Calculation of these flux densities requires introducing several additional quantities. The atmospheric transmissivity, <span class="math inline">\(\tau\)</span>, ranges between 0.6 and 0.7 for typical clear sky conditions <span class="citation">(Gates 2012)</span>. The solar constant, <span class="math inline">\(S_{p0}\)</span>, approximates extraterrestrial flux density as <span class="math inline">\(1,360 W m^{−2}\)</span>. The optical air mass number, <span class="math inline">\(m_a\)</span>, is the ratio of slant path length through the atmosphere to zenith path length and is a function of atmospheric pressure: <span class="math inline">\(m_a=p_a/(101.3\cos(\psi))\)</span>, where <span class="math inline">\(p_a\)</span> is air pressure (kPa) and <span class="math inline">\(\psi\)</span> is zenith angle (°, see above). The function <code><a href="../reference/airpressure_from_elev.html">airpressure_from_elev()</a></code> estimates air pressure as <span class="math inline">\(p_a (kPa)= 101.3 e ^{\frac{-E}{8200}}\)</span>, where <span class="math inline">\(E\)</span> is the elevation in meters above sea level. TrenchR provides a function to estimate air pressure from elevation (m).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4000</span>, <span class="fu"><a href="../reference/airpressure_from_elev.html">airpressure_from_elev</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4000</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab<span class="op">=</span><span class="st">"elevation (m)"</span>, ylab<span class="op">=</span><span class="st">"air pressure (kPa)"</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
<p>Direct irradiance is a function of the distance a solar beam travels through the atmosphere; the transmittance of the atmosphere, <span class="math inline">\(\tau\)</span>; and the incident flux density, <span class="math inline">\(S_{p0}\)</span>: <span class="math inline">\(S_p=S_{p0}\tau^{m_a}\)</span>. We approximate diffuse radiation using an empirical relation <span class="citation">(Liu and Jordan 1960)</span>, <span class="math inline">\(S_d=0.3(1-\tau^{m_a}) S_{p0}\cos\psi\)</span>. Finally, reflected radiation is the product of albedo, <span class="math inline">\(\rho_S\)</span>, and the sum of direct and diffuse radiation: <span class="math inline">\(S_r= \rho_S (S_p+S_d)\)</span>. We estimate the direct, diffuse, and reflected components of solar radiation (<span class="math inline">\(W m^{-2}\)</span>) as follows.</p>
<p>We estimate how solar radiation components vary diurnally.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">zenith_angle</span>, doy<span class="op">=</span><span class="fl">200</span>, lat<span class="op">=</span><span class="fl">47.61</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">122.33</span><span class="op">)</span><span class="op">)</span>
<span class="va">zen</span><span class="op">=</span> <span class="va">zen</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span>
<span class="va">rd</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">zen</span>, FUN<span class="op">=</span><span class="va">estimate_radiation</span>, doy<span class="op">=</span><span class="fl">200</span>, tau<span class="op">=</span><span class="fl">0.6</span>, elev<span class="op">=</span><span class="fl">1500</span>, rho<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>
<span class="co">#unlist</span>
<span class="va">rd</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">rd</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"hour"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">radiation</span> <span class="op">~</span> <span class="op">(</span><span class="va">W</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">800</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"solar radiation flux"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"direct"</span>, <span class="st">"diffuse"</span>, <span class="st">"reflected"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>We then examine how solar radiation components vary as a function of zenith angle.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">psi.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">rd</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">psi.seq</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">/</span><span class="fl">360</span>, FUN<span class="op">=</span><span class="va">estimate_radiation</span>, doy<span class="op">=</span><span class="fl">200</span>, tau<span class="op">=</span><span class="fl">0.75</span>, elev<span class="op">=</span><span class="fl">1500</span>, rho<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span>
<span class="co">#unlist</span>
<span class="va">rd</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">rd</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">psi.seq</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"zenith angle (°)"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">radiation</span> <span class="op">~</span> <span class="op">(</span><span class="va">W</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1200</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">psi.seq</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">psi.seq</span>, <span class="va">rd</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"solar radiation flux"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"direct"</span>, <span class="st">"diffuse"</span>, <span class="st">"reflected"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-12-1.png" width="576"> Similar but alternative algorithms for estimating hourly direct solar radiation (<span class="math inline">\(W m^{-2}\)</span>) were adapted from a comparison of the methods by Tracy et al. <span class="citation">(1983)</span>. Algorithms from earleir versions of Campbell and Norman <span class="citation">(2012)</span> and Gates <span class="citation">(2012)</span> are implemented. Both estimate radiation as a function of latitude, day of year, elevation, and time.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">20</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">direct_solar_radiation</span>, lat<span class="op">=</span><span class="fl">43.57</span>,doy<span class="op">=</span><span class="fl">112</span>,elev<span class="op">=</span><span class="fl">866</span>,t0<span class="op">=</span><span class="fl">12</span>, method<span class="op">=</span><span class="st">"Campbell 1977"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r.seq</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">20</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"hour"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">radiation</span> <span class="op">~</span> <span class="op">(</span><span class="va">W</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">20</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">direct_solar_radiation</span>, lat<span class="op">=</span><span class="fl">43.57</span>,doy<span class="op">=</span><span class="fl">112</span>,elev<span class="op">=</span><span class="fl">866</span>,t0<span class="op">=</span><span class="fl">12</span>, method<span class="op">=</span><span class="st">"Gates 1962"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">20</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"Radiation algorithm"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Campbell 1977"</span>, <span class="st">"Gatesd 1962"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-13-1.png" width="480"></p>
<p>We additionally provide a function (<code><a href="../reference/monthly_solar_radiation.html">monthly_solar_radiation()</a></code>) implementing an algorithm to estimate average monthly solar radiation (<span class="math inline">\(W m^{-2}\)</span> per day) using basic topographic and climatic information as input.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">365</span>,<span class="fl">31</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">monthly_solar_radiation</span>, lat<span class="op">=</span><span class="fl">43.57</span>,lon<span class="op">=</span><span class="op">-</span><span class="fl">116.22</span>,elev<span class="op">=</span><span class="fl">866</span>,T<span class="op">=</span><span class="fl">20</span>,Hr<span class="op">=</span><span class="fl">15</span>,P<span class="op">=</span><span class="fl">15</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">r.seq</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">365</span>,<span class="fl">31</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"day of year"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">radiation</span> <span class="op">~</span> <span class="op">(</span><span class="va">W</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>We provide a function <code><a href="../reference/partition_solar_radiation.html">partition_solar_radiation()</a></code> to estimate the diffuse fraction <span class="math inline">\(k_d\)</span> that can be used to partition measures of solar radiation into direct and diffuse components. The partitioning is based on empirically-derived relations estimated as a function of the clearness index <span class="math inline">\(k_t\)</span>, which is the ratio of the global solar radiation measured at the surface to the total solar radiation at the top of the atmosphere. The relations are compiled in Wong and Chow <span class="citation">(2001)</span>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Erbs"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"clearness index"</span> <span class="op">~</span> <span class="va">k</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"diffuse fraction"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Liu_Jordan"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Orgill_Hollands"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Olyphant"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotdash"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Reindl-1"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"longdash"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Reindl-2"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"longdash"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">partition_solar_radiation</span>, method<span class="op">=</span><span class="st">"Lam_Li"</span>, lat<span class="op">=</span><span class="fl">40</span>, sol.elev<span class="op">=</span><span class="fl">60</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"twodash"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"Partitioning method"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Erbs"</span>, <span class="st">"Liu_Jordan"</span>, <span class="st">"Orgill_Hollands"</span>, <span class="st">"Olyphant"</span>, <span class="st">"Reindl-1"</span>, <span class="st">"Reindl-2"</span>, <span class="st">"Lam_Li"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dashed"</span>,<span class="st">"dotted"</span>,<span class="st">"dotdash"</span>,<span class="st">"longdash"</span>,<span class="st">"longdash"</span>,<span class="st">"twodash"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-15-1.png" width="768"> The functions above are fairly coarse approximations. The SOLRAD routine by McCullough and Porter <span class="citation">(1971)</span> accounts for additional determinations of the diffuse fractions such as zenith angle, atmospheric pressure, and surface albedo. The SOLRAD routine is implemented in NicheMapR. TrenchR implements a numeric approximation to the SOLRAD routine from Tracy et al. <span class="citation">(1983)</span>. We illustrate how the diffuse proportion shifts as a function of zenith angle for several different levels of atmospheric pressure and note the function general estimates a lower fraction of diffuse radiation than the algorithms above.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">proportion_diffuse_solar_radiation</span>, p_a<span class="op">=</span><span class="fl">86.1</span>, A<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"zenith angle (°)"</span>, ylab <span class="op">=</span> <span class="st">"diffuse fraction"</span><span class="op">)</span>

<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">proportion_diffuse_solar_radiation</span>, p_a<span class="op">=</span><span class="fl">96.1</span>, A<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, FUN<span class="op">=</span><span class="va">proportion_diffuse_solar_radiation</span>, p_a<span class="op">=</span><span class="fl">76.1</span>, A<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">85</span><span class="op">)</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
</div>
</div>
<div class="section level1">
<h1 id="temperature-and-wind-speed-profiles">Temperature and wind speed profiles<a class="anchor" aria-label="anchor" href="#temperature-and-wind-speed-profiles"></a>
</h1>
<p>Temperatures and wind speeds, standardly collected at a height of 2m, can differ dramatically from conditions near the ground where most organisms live. Turbulent airflow influenced by the ground surface roughness sets up temperature and wind speed profiles. These profiles can be estimated to scale temperatures and wind speeds to organism height. We scale across height by estimating a wind speed profile using the relationship: <span class="math display">\[u(z)= \frac{u^*}{0.41}ln \frac{z-d}{z_m} \]</span> where <span class="math inline">\(u(z)\)</span> is the wind speed (m/s) at height <span class="math inline">\(z\)</span> (m), <span class="math inline">\(u^*\)</span> is the friction velocity (m/s), <span class="math inline">\(d\)</span> is the zero-plane displacement (m, the height at which wind speed is zero), and the constant 0.41 is the von Karman constant.</p>
<p>We provide a function to use this relationship to estimate surface roughness (<code><a href="../reference/surface_roughness.html">surface_roughness()</a></code>) from wind speed measurements at a vector of heights. First, the zero-plane displacement is estimated as the intercept of the relationship between the wind velocities and the log of measurement height. Surface roughness <span class="math inline">\(z_0\)</span> can then be estimated by repeating the regression accounting for the zero-plane displacement (by subtracting the zero-plane displacement from the measurement heights). <span class="math inline">\(z_0\)</span> is estimated as the exponential of the ratio of the intercept and slope of the regression relationship as follows.</p>
<p>We illustrate estimating surface roughness.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">u_r</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span><span class="op">)</span>
<span class="va">zr</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/surface_roughness.html">surface_roughness</a></span><span class="op">(</span><span class="va">u_r</span>, <span class="va">zr</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.06485225</span></code></pre>
<p>We use the following relationship to estimate air temperature and wind speed at height <span class="math inline">\(z\)</span> under neutral conditions (no buoyancy associated with differential density): <span class="math display">\[\frac{u_z}{u_r}=\frac{ln(z/z_0+1)}{ln(z_r/z_0+1)}=\frac{T_z-T_0}{T_r-T_0} \]</span> where <span class="math inline">\(u_z\)</span> and <span class="math inline">\(u_r\)</span> are the wind speeds (m/s) at height <span class="math inline">\(z\)</span> (m) and reference height <span class="math inline">\(r\)</span> (m), respectively. <span class="math inline">\(T_z\)</span>, <span class="math inline">\(T_r\)</span>, and <span class="math inline">\(T_0\)</span> are air and soil temperatures at heights <span class="math inline">\(z\)</span> and <span class="math inline">\(r\)</span> and soil surface temperature, respectively. We provide this relationship in the <code><a href="../reference/wind_speed_profile_neutral.html">wind_speed_profile_neutral()</a></code> function, which estimates wind speed at a specified height. We additionally provide this relationship in the <code><a href="../reference/air_temp_profile_neutral.html">air_temp_profile_neutral()</a></code> function, which estimates temperature at a specified height.</p>
<p>We examine how the wind speed profiles varies with wind speed (m/s).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zs</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0.1</span><span class="op">)</span> 
<span class="va">us</span><span class="op">=</span> <span class="fu"><a href="../reference/wind_speed_profile_neutral.html">wind_speed_profile_neutral</a></span><span class="op">(</span>u_r<span class="op">=</span><span class="fl">1</span>, zr<span class="op">=</span><span class="fl">2</span>, z0<span class="op">=</span><span class="fl">0.2</span>, z<span class="op">=</span><span class="va">zs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">us</span>,<span class="va">zs</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"wind speed, u (m/s)"</span>, ylab <span class="op">=</span> <span class="st">"height, z (m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="../reference/wind_speed_profile_neutral.html">wind_speed_profile_neutral</a></span><span class="op">(</span>u_r<span class="op">=</span><span class="fl">0.5</span>, zr<span class="op">=</span><span class="fl">2</span>, z0<span class="op">=</span><span class="fl">0.2</span>, z<span class="op">=</span><span class="va">zs</span><span class="op">)</span>, <span class="va">zs</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="../reference/wind_speed_profile_neutral.html">wind_speed_profile_neutral</a></span><span class="op">(</span>u_r<span class="op">=</span><span class="fl">0.25</span>, zr<span class="op">=</span><span class="fl">2</span>, z0<span class="op">=</span><span class="fl">0.2</span>, z<span class="op">=</span><span class="va">zs</span><span class="op">)</span>, <span class="va">zs</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, title<span class="op">=</span><span class="st">"wind speed at 2m"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dotted"</span>,<span class="st">"dashed"</span>,<span class="st">"solid"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>We next illustrate the influence of surface roughness on air temperature profiles.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile_neutral.html">air_temp_profile_neutral</a></span><span class="op">(</span>T_r<span class="op">=</span><span class="fl">20</span>, zr<span class="op">=</span><span class="fl">1</span>, z0<span class="op">=</span><span class="fl">0.02</span>, z<span class="op">=</span><span class="va">z.seq</span>, T_s<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Temperature (°C)"</span>, ylab <span class="op">=</span> <span class="st">"z (height above ground in m)"</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile_neutral.html">air_temp_profile_neutral</a></span><span class="op">(</span>T_r<span class="op">=</span><span class="fl">20</span>, zr<span class="op">=</span><span class="fl">1</span>, z0<span class="op">=</span><span class="fl">0.05</span>, z<span class="op">=</span><span class="va">z.seq</span>, T_s<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile_neutral.html">air_temp_profile_neutral</a></span><span class="op">(</span>T_r<span class="op">=</span><span class="fl">20</span>, zr<span class="op">=</span><span class="fl">1</span>, z0<span class="op">=</span><span class="fl">0.08</span>, z<span class="op">=</span><span class="va">z.seq</span>, T_s<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"surface roughness"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.05</span>, <span class="fl">0.08</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>Temperature at a given height is computed by the function <code><a href="../reference/air_temp_profile.html">air_temp_profile()</a></code> by first estimating the temperature at roughness height: <span class="math display">\[T_{z_0}= \frac{T_r S_{t_b}-T_0 S_{t_s}}{S_{t_b}-S_{t_s}}. \]</span> where <span class="math inline">\(S_{t_s}\)</span> is the sublayer Stanton Number <span class="math inline">\(S_{t_s}=0.62/ (\frac{z_0u^*}{12})^{0.45}\)</span> and <span class="math inline">\(S_{t_b}\)</span> is the bulk Stanton Number <span class="math inline">\(S_{t_b}=0.64/ (\frac{z}{z_0}+1)\)</span>. The Stanton numbers are dimensionless numbers that measures the ratio of the heat transferred in and the thermal capacity. The temperature at height <span class="math inline">\(z\)</span> can then be estimated as: <span class="math display">\[T_z= T_{z_0}+(T_r-T_{z_0})ln(\frac{z}{z_0}+1) .\]</span> We estimate air temperature profiles in TrenchR as:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile.html">air_temp_profile</a></span><span class="op">(</span>T_r <span class="op">=</span> <span class="fl">20</span>, u_r <span class="op">=</span> <span class="fl">0.5</span>, zr <span class="op">=</span> <span class="fl">2</span>, z0 <span class="op">=</span> <span class="fl">0.02</span>, z <span class="op">=</span> <span class="va">z.seq</span>, T_s <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Temperature (°C)"</span>, ylab <span class="op">=</span> <span class="st">"z (height above ground in m)"</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile.html">air_temp_profile</a></span><span class="op">(</span>T_r <span class="op">=</span> <span class="fl">20</span>, u_r <span class="op">=</span> <span class="fl">0.5</span>, zr <span class="op">=</span> <span class="fl">2</span>, z0 <span class="op">=</span> <span class="fl">0.05</span>, z <span class="op">=</span> <span class="va">z.seq</span>, T_s <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">t.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/air_temp_profile.html">air_temp_profile</a></span><span class="op">(</span>T_r <span class="op">=</span> <span class="fl">20</span>, u_r <span class="op">=</span> <span class="fl">0.5</span>, zr <span class="op">=</span> <span class="fl">2</span>, z0 <span class="op">=</span> <span class="fl">0.08</span>, z <span class="op">=</span> <span class="va">z.seq</span>, T_s <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"surface roughness"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.05</span>, <span class="fl">0.08</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>TrenchR also adapts functions from NicheMapR <span class="citation">(Kearney and Porter 2017)</span> to refine wind speed and air temperature profiles by using multiple segments:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">t.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">z.seq</span>, FUN<span class="op">=</span><span class="va">air_temp_profile_segment</span>, T_r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">22</span>,<span class="fl">20</span><span class="op">)</span>,u_r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>, zr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span>, z0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span><span class="op">)</span>, T_s<span class="op">=</span><span class="fl">27</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Temperature (°C)"</span>, ylab <span class="op">=</span> <span class="st">"z (height above ground in m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">27</span>,<span class="fl">25</span>,<span class="fl">22</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-21-1.png" width="480"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">u.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">z.seq</span>, FUN<span class="op">=</span><span class="va">wind_speed_profile_segment</span>, u_r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>, zr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span>, z0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">u.seq</span>, <span class="va">z.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Wind speed (m/s)"</span>, ylab <span class="op">=</span> <span class="st">"z (height above ground in m)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-22-1.png" width="480"></p>
</div>
<div class="section level1">
<h1 id="diurnal-variation-in-temperature-and-radiation">Diurnal variation in temperature and radiation<a class="anchor" aria-label="anchor" href="#diurnal-variation-in-temperature-and-radiation"></a>
</h1>
<p>We provide three forms of equations to estimate diurnal temperature radiation: a sine model, a sine exponential model, and a sine square root model. The models assume that maximum temperature <span class="math inline">\(T_x\)</span> will occur sometime between sunrise <span class="math inline">\(t_r\)</span> and sunset <span class="math inline">\(t_s\)</span> and that the minimum temperature <span class="math inline">\(T_n\)</span> will occur in the early morning.</p>
<p>The sine model (<code><a href="../reference/diurnal_temp_variation_sine.html">diurnal_temp_variation_sine()</a></code>) estimates temperature <span class="math inline">\(T\)</span> at hour <span class="math inline">\(h\)</span> as a function of minimum and maximum temperature <span class="math display">\[T(h)= T_x -T_n(1-\gamma), \]</span> where <span class="math inline">\(\gamma=0.44-0.46 \sin (0.9+WH_r)+0.11 \sin(0.9+2WH_r)\)</span> and <span class="math inline">\(W=\pi/12\)</span></p>
<p>For the sine exponential model (<code><a href="../reference/diurnal_temp_variation_sineexp.html">diurnal_temp_variation_sineexp()</a></code>), hourly temperature is estimated as a function of three empirically determined parameters: <span class="math inline">\(\alpha\)</span> is the time difference between the hour of maximum temperature <span class="math inline">\(h_x\)</span> and midday; <span class="math inline">\(\beta\)</span> is the time difference between the hour of minimum temperature <span class="math inline">\(h_n\)</span> and sunrise; and <span class="math inline">\(\gamma\)</span> is a decay parameter that determines the rate of temperature change from sunset to <span class="math inline">\(h'_n\)</span> of the next day.</p>
<p>The time of maximum temperature can be calculated as <span class="math inline">\(h_x=1/2(t_r+t_s)+\alpha\)</span>. The time of minimum temperature can be calculated as <span class="math inline">\(t_n=t_r+\beta\)</span>. The model estimates temperature at time <span class="math inline">\(h\)</span> as follows: <span class="math display">\[  T(h)=\left \{
                \begin{array}{ll}
                  T_n+(T_x-T_n)\sin \frac{\pi(h-h_r-\beta)}{l +2(\alpha-\beta)}, h_n \leq h \leq h_s\\
                  T_n'+[T(h_s)-T'_n]\exp \frac{\gamma(h-h_s)}{24-l+\beta}, h_s \leq h \leq h'_n 
                \end{array}
              \right. \]</span> where <span class="math inline">\(h'_n\)</span> is the time of the minimum temperature, <span class="math inline">\(T'_n\)</span>, for the next day. Day length <span class="math inline">\(l\)</span> is calculated as <span class="math inline">\(h_s-h_r\)</span>.</p>
<p>The sine square root model (<code><a href="../reference/diurnal_temp_variation_sinesqrt.html">diurnal_temp_variation_sinesqrt()</a></code>) estimates temperature assuming the time of maximum temperature <span class="math inline">\(t_x\)</span> occurs 4 hours before sunset (<span class="math inline">\(t_x=t_s -4\)</span>): <span class="math display">\[  T(h)=\left \{
                \begin{array}{ll}
                  T_n+\alpha \pi /2 \left \{ \frac{h-h_r}{h_x-h_r} \right \}, h_r &lt; h \leq h_x\\
                  T_r+R \sin [\pi/2+(\frac{h-h_x}{4})\pi/2], h_x &lt; h &lt; h_s\\ 
                  T_r+b \sqrt{h-h_s}, h_s &lt; h \leq h_p
                \end{array}
              \right. \]</span> where <span class="math inline">\(\alpha=T_x-T_n\)</span>,<span class="math inline">\(R=T_x-T_s\)</span>, and <span class="math inline">\(b=\frac{T_p-T_s}{\sqrt{h_p - h_s}}\)</span>. Sunset temperature is estimated as <span class="math inline">\(T_s=T_x-c(T_x-T_p)\)</span> where <span class="math inline">\(c\)</span> is an empirically estimated parameter (<span class="math inline">\(c=0.39\)</span>).</p>
<p>TrenchR provides the functions as follows:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span>, <span class="fu"><a href="../reference/diurnal_temp_variation_sine.html">diurnal_temp_variation_sine</a></span><span class="op">(</span>T_max<span class="op">=</span><span class="fl">30</span>, T_min<span class="op">=</span><span class="fl">10</span>, t<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"hour"</span>, ylab <span class="op">=</span> <span class="st">"temperature (°C)"</span><span class="op">)</span>
<span class="va">t.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span>, FUN<span class="op">=</span><span class="va">diurnal_temp_variation_sineexp</span>, T_max<span class="op">=</span><span class="fl">30</span>, T_min<span class="op">=</span><span class="fl">10</span>, t_r<span class="op">=</span><span class="fl">6</span>, t_s<span class="op">=</span><span class="fl">18</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span>, <span class="va">t.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span>, <span class="fu"><a href="../reference/diurnal_temp_variation_sinesqrt.html">diurnal_temp_variation_sinesqrt</a></span><span class="op">(</span>t<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">23</span>, tr<span class="op">=</span><span class="fl">6</span>, ts<span class="op">=</span><span class="fl">18</span>, T_max<span class="op">=</span><span class="fl">30</span>, T_min<span class="op">=</span><span class="fl">10</span>, T_minp<span class="op">=</span><span class="fl">12</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, title<span class="op">=</span><span class="st">"function"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_sine"</span>, <span class="st">"_sineexp"</span>, <span class="st">"_sinesqrt"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotted"</span>,<span class="st">"dashed"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p>We adapt equations from Tham et al. <span class="citation">(2010)</span> to estimate hourly solar radiation (<span class="math inline">\(W m^{-2}\)</span> per hour) as a function of daily global solar radiation (in <span class="math inline">\(W m^{-2}\)</span> per day). The function <code><a href="../reference/diurnal_radiation_variation.html">diurnal_radiation_variation()</a></code> partitions daily solar radiation <span class="math inline">\(S\)</span>. The function estimates the ratio of hourly to daily global irradiation,<span class="math inline">\(S_G\)</span>, as follows: <span class="math display">\[S_G= \frac{\pi}{24}(a'+b'\cos \omega)\frac{\cos \omega - \cos \omega_s}{\sin \omega_s - \omega_s \cos \omega_s}, \]</span> where <span class="math inline">\(a'= 0.409+0.5016\sin(\omega_s-1.047)\)</span> and <span class="math inline">\(b'=0.6609-0.4767\sin(\omega_s-1.047)\)</span>. The function utilizes two angles in radians: <span class="math inline">\(\omega\)</span> is the hour angle of the sun and <span class="math inline">\(\omega_s\)</span> is the hour angle at sunset. The function calculates these angles as a function of calendar date <span class="math inline">\(J\)</span> and location (latitude and longitude). We depict how the diurnal trends in radiation vary across the year (also assuming differences in total radiation).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">diurnal_radiation_variation</span>, doy<span class="op">=</span><span class="fl">172</span>, solrad<span class="op">=</span><span class="fl">8000</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">112.07</span>, lat<span class="op">=</span><span class="fl">33.45</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"hour"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">radiation</span> <span class="op">~</span> <span class="op">(</span><span class="va">W</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">diurnal_radiation_variation</span>, doy<span class="op">=</span><span class="fl">356</span>, solrad<span class="op">=</span><span class="fl">4000</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">112.07</span>, lat<span class="op">=</span><span class="fl">33.45</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">diurnal_radiation_variation</span>, doy<span class="op">=</span><span class="fl">266</span>, solrad<span class="op">=</span><span class="fl">6000</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">112.07</span>, lat<span class="op">=</span><span class="fl">33.45</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span>
<span class="va">r.seq</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">diurnal_radiation_variation</span>, doy<span class="op">=</span><span class="fl">228</span>, solrad<span class="op">=</span><span class="fl">6000</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">112.07</span>, lat<span class="op">=</span><span class="fl">33.45</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">r.seq</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"dotdash"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"day of year"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">172</span>,<span class="fl">228</span>,<span class="fl">266</span>,<span class="fl">356</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>,<span class="st">"dotdash"</span>,<span class="st">"dashed"</span>,<span class="st">"dotted"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div class="section level1">
<h1 id="degree-days">Degree days<a class="anchor" aria-label="anchor" href="#degree-days"></a>
</h1>
<p>Many organismal processes and rates are temperature dependent. Accounting for temperature dependence allows translating calendar time into a more biologically relevant concept known as degree days. Degree days indicate the accumulated heat available for processes such as development and are estimated as the accumulated product of time and temperature. For the frequent application of estimating development, degree days are calculated within physiological bounds known as the lower and upper developmental temperatures, LDT and UDT, respectively. We provide four approaches for estimating degree days that differ in the complexity with which they aggregate heat: “single.sine”, “double.sine”, “single.triangulation” or “double.triangulation”. We implement the methods detailed here: <a href="http://ipm.ucanr.edu/WEATHER/ddfigindex.html" class="external-link uri">http://ipm.ucanr.edu/WEATHER/ddfigindex.html</a>. The methods account for whether the temperature time series is intercepted by the LDT and / or the UDT. Briefly, we present the equations for each method for the case of the temperature time series being intercepted by the lower threshold. For the single-sine method, degree days <span class="math inline">\(D\)</span> can be estimated as <span class="math display">\[D= \frac{1}{\pi} \left[ \left( \frac{T_x+T_n}{2}-LDT \right) +\alpha\cos(\theta_1) \right] \\
\theta_1= \sin^{-1}\left[ 1/ \alpha \left( LDT- \frac{T_x+T_n}{2} \right) \right]\]</span></p>
<p>For the double-sine method, degree days <span class="math inline">\(D\)</span> can be estimated as <span class="math display">\[D= \frac{1}{2\pi} \left[ \left( \frac{T_x+T_n}{2}-LDT \right)(\pi/2- \theta_1 ) +\alpha\cos(\theta_1) \right] \\
\theta_1= \sin^{-1}\left[ 1/ \alpha \left( LDT- \frac{T_x+T_n}{2} \right) \right].\]</span></p>
<p>For the single triangulation method, degree days <span class="math inline">\(D\)</span> can be estimated as <span class="math display">\[D= \frac{(T_x-LDT)^2}{2(T_x-T_n)} .\]</span> For the double triangulation method, degree days <span class="math inline">\(D\)</span> can be estimated as <span class="math display">\[D= \frac{(T_x-LDT)^2}{4(T_x-T_n)}. \]</span></p>
<p>The methods are available in the following R function. Note the function calculates degree days for a full day assuming symmetry in minimum temperatures.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/degree_days.html">degree_days</a></span><span class="op">(</span>T_min<span class="op">=</span><span class="fl">7</span>, T_max<span class="op">=</span><span class="fl">14</span>, LDT<span class="op">=</span><span class="fl">12</span>, UDT<span class="op">=</span><span class="fl">33</span>, method<span class="op">=</span><span class="st">"single.sine"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.47</span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/degree_days.html">degree_days</a></span><span class="op">(</span>T_min<span class="op">=</span><span class="fl">7</span>, T_max<span class="op">=</span><span class="fl">14</span>, LDT<span class="op">=</span><span class="fl">12</span>, UDT<span class="op">=</span><span class="fl">33</span>, method<span class="op">=</span><span class="st">"double.sine"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.47</span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/degree_days.html">degree_days</a></span><span class="op">(</span>T_min<span class="op">=</span><span class="fl">7</span>, T_max<span class="op">=</span><span class="fl">14</span>, LDT<span class="op">=</span><span class="fl">12</span>, UDT<span class="op">=</span><span class="fl">33</span>, method<span class="op">=</span><span class="st">"single.triangulation"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.29</span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/degree_days.html">degree_days</a></span><span class="op">(</span>T_min<span class="op">=</span><span class="fl">7</span>, T_max<span class="op">=</span><span class="fl">14</span>, LDT<span class="op">=</span><span class="fl">12</span>, UDT<span class="op">=</span><span class="fl">33</span>, method<span class="op">=</span><span class="st">"double.triangulation"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.29</span></code></pre>
</div>
<div class="section level1">
<h1 id="soil-temperatures">Soil temperatures<a class="anchor" aria-label="anchor" href="#soil-temperatures"></a>
</h1>
<p>TrenchR includes a microclimate model that uses finite-difference methods to solve heat balance equations describing soil temperatures at the surface and specified depths. The function requires air temperature and radiation data as input. Our approach follows Porter et al. <span class="citation">(1973)</span> and is similar to that described for the NicheMapR R package <span class="citation">(Kearney and Porter 2017)</span>. The primary function to call to calculate soil temperature is <code><a href="../reference/soil_temperature.html">soil_temperature()</a></code>. The function is a wrapper to solve the differential equations below for equilibrium conditions. The called function <code><a href="../reference/soil_temperature_function.html">soil_temperature_function()</a></code> contains the majority of the soil temperature model and calls two helper functions. The two functions implement an equation for calculating soil temperature adapted from Beckman et al. <span class="citation">(1973)</span>; <code><a href="../reference/soil_temperature_integrand.html">soil_temperature_integrand()</a></code> includes the integrand in the equation and is called by <code><a href="../reference/soil_temperature_equation.html">soil_temperature_equation()</a></code>, which represents the full equation. Below we outline the soil temperature model encapsulated by the functions.</p>
<p>The change in soil temperature (<span class="math inline">\(T_s\)</span>) through time <span class="math inline">\(t\)</span> and depth <span class="math inline">\(z\)</span> can be approximated with a differential equation <span class="math display">\[\frac{dT_s}{dt}= \frac{k_s}{\rho_s c_s} \frac{\delta^2T_s}{\delta z^2}\]</span> where <span class="math inline">\(k_s\)</span> is the thermal conductivity of soil (W/m·K), <span class="math inline">\(\rho_s\)</span> is the density of soil, and <span class="math inline">\(c_s\)</span> is the specific heat of soil (J/kg·K). We solve the differential equation by breaking the soil profile into depth nodes, exchanging heat. We estimate the steady-state temperature profile, which is independent of initial conditions. The choice of initial conditions only affects the rate of convergence to the steady-state solution. A finite difference approximation of the differential equation yields a transient equation for the temperature at depth <span class="math inline">\(i\)</span> and time <span class="math inline">\(p\)</span> where we let <span class="math inline">\(a= \frac{k_s}{\rho_s c_s}\)</span>: <span class="math display">\[\frac{T_i^{p+1}-T_i^p}{dt}= a \frac{T_{i+dz}^p+T_{i-dz}^p-2T_i^p}{dz^2}. \]</span> Solving for <span class="math inline">\(T_i^{p+1}\)</span> produces as expression for solving soil temperature at depth <span class="math inline">\(i\)</span> at any time: <span class="math display">\[T_i^{p+1} = a \frac{dt}{dz^2}(T_{i+dz}^p+T_{i-dz}^p)+(1-2a \frac{dt}{dz^2})T_i^p\]</span></p>
<p>##Soil boundary conditions Solving the equation requires two boundary conditions: 1) the deep soil temperature, and 2) the soil surface temperature. We assume that the soil temperature at 60cm is constant diurnally. The soil surface temperature at time <span class="math inline">\(p\)</span> is estimated using an energy balance equating the energy conducted to the soil surface the net heat transfer to the surface by solar radiation, infrared radiation, and conduction <span class="citation">(Beckman, Mitchell, and Porter 1973)</span>: <span class="math display">\[Q_{net_s}= Q_{sol_s} + Q_{emit_s} + Q_{conv_s} +Q_{cond_s}\]</span> where the solar radiation absorbed by the soil surface is the product of incoming radiation <span class="math inline">\(S\)</span> and the proportion of radiation absorbed <span class="math inline">\(\alpha_s\)</span>, <span class="math inline">\(Q_{sol_s}= \alpha_s S\)</span>. The net thermal radiation to the soil surface is determined by the balance of radiation emitted by the soil surface <span class="math inline">\(\sigma T_s^4\)</span> and sky radiation absorbed by the soil surface <span class="math inline">\(\sigma T_{sky}^4\)</span>: <span class="math inline">\(Q_{emit_s}= \epsilon_s \sigma [(T^p_{sky})^4-(T^p_0)^4]\)</span>, where <span class="math inline">\(\epsilon_s\)</span> is the thermal emissivity of the soil surface and <span class="math inline">\(T^p_{sky}=0.552 T^{1.5}\)</span>. Convection between the soil surface and air is estimated as a function of the temperature difference <span class="math inline">\(Q_{conv_s}= h_s(T^p-T^p_s)\)</span>, where <span class="math inline">\(h_s\)</span> is the surface heat transfer coefficient. Consideration of temperature profiles and surface roughness yields an expression during neutral conditions <span class="citation">(Sellers 1965)</span>: <span class="math display">\[h_s= \frac{\rho_s c_s k^2 V_r}{ln(z_r/z_o+1)^2},\]</span> where <span class="math inline">\(V\)</span> is the wind speed at reference height <span class="math inline">\(z_r\)</span> and <span class="math inline">\(z_0\)</span> is roughness length. Conduction within the soil profile is estimated as <span class="math inline">\(Q_{cond_s}=k_s \frac{\delta T_s}{\delta z}\)</span>, at <span class="math inline">\(z=0\)</span>. Approximating <span class="math inline">\(Q_{cond_s}\)</span> by finite difference yields <span class="math inline">\(Q_{cond_s}=\frac{k_s}{dz}(T^p_{dz}-T^p_s)\)</span>, at <span class="math inline">\(z=0\)</span></p>
<p>The net heat transfer through the profile across time is expressed as <span class="math display">\[Q_{net_s}= \frac{\rho_s c_s dz}{2 dt} (T_0^{p+1}-T_0^p).\]</span> Letting <span class="math inline">\(a=\frac{2dt}{\rho_s c_s dz}\)</span> and solving for <span class="math inline">\(T_0^{p+1}\)</span> in the soil energy budget yields the following boundary condition for soil surface temperature: <span class="math display">\[T_0^{p+1}= a \alpha_s S + a \epsilon_S \sigma [(T^p_{sky})^4-(T^p_0)^4]+a h_s (T^p-T_0^p) +a \frac{k_s}{dz}(T^p_{dz}-T^p_0)+T_0^p\]</span></p>
<p>Soil temperature can be estimated in TrenchR as follows. The solid line depicts air temperature (°C).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span>

<span class="va">temp_vector</span><span class="op">=</span> <span class="fu"><a href="../reference/diurnal_temp_variation_sine.html">diurnal_temp_variation_sine</a></span><span class="op">(</span>T_max<span class="op">=</span><span class="fl">20</span>, T_min<span class="op">=</span><span class="op">-</span><span class="fl">10</span>, t<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">wind_speed_vector</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">96</span>, min<span class="op">=</span><span class="fl">0</span>, max<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>
<span class="va">time_vector</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>,<span class="fl">4</span><span class="op">)</span>
<span class="va">solrad_vector</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, FUN<span class="op">=</span><span class="va">diurnal_radiation_variation</span>, doy<span class="op">=</span><span class="fl">172</span>, solrad<span class="op">=</span><span class="fl">8000</span>, lon<span class="op">=</span><span class="op">-</span><span class="fl">112.07</span>, lat<span class="op">=</span><span class="fl">33.45</span><span class="op">)</span><span class="op">)</span>
<span class="va">solrad_vector</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">solrad_vector</span>,<span class="fl">4</span><span class="op">)</span>

<span class="va">params</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SSA<span class="op">=</span><span class="fl">0.7</span>, epsilon_so<span class="op">=</span><span class="fl">0.98</span>, k_so<span class="op">=</span><span class="fl">0.293</span>, c_so<span class="op">=</span><span class="fl">800</span>, dz<span class="op">=</span><span class="fl">0.05</span>, z_r<span class="op">=</span><span class="fl">1.5</span>, z0<span class="op">=</span><span class="fl">0.02</span>, H<span class="op">=</span><span class="va">solrad_vector</span>, T_a<span class="op">=</span><span class="va">temp_vector</span>, u<span class="op">=</span><span class="va">wind_speed_vector</span>, rho_a<span class="op">=</span><span class="fl">1.177</span>,rho_so<span class="op">=</span><span class="fl">1620</span>, c_a<span class="op">=</span><span class="fl">1006</span>, TimeIn<span class="op">=</span><span class="va">time_vector</span>, dt<span class="op">=</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span>, shade<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="va">temp_vector</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"hour"</span>, ylab<span class="op">=</span><span class="st">"temperature (°C)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>

<span class="va">T_soil</span><span class="op">=</span> <span class="fu"><a href="../reference/soil_temperature.html">soil_temperature</a></span><span class="op">(</span>z_r.intervals<span class="op">=</span><span class="fl">12</span>,z_r<span class="op">=</span><span class="fl">1.5</span>, z<span class="op">=</span><span class="fl">2</span>, T_a<span class="op">=</span><span class="va">temp_vector</span>, u<span class="op">=</span><span class="va">wind_speed_vector</span>, Tsoil0<span class="op">=</span> <span class="fl">20</span>, z0<span class="op">=</span><span class="fl">0.02</span>, SSA<span class="op">=</span><span class="fl">0.7</span>, TimeIn<span class="op">=</span><span class="va">time_vector</span>, H<span class="op">=</span> <span class="va">solrad_vector</span>, water_content<span class="op">=</span><span class="fl">0.2</span>, air_pressure<span class="op">=</span><span class="fl">85</span>, rho_so<span class="op">=</span><span class="fl">1620</span>, shade<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="va">T_soil</span>, lty<span class="op">=</span><span class="st">"dashed"</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>

<span class="va">T_soil</span><span class="op">=</span> <span class="fu"><a href="../reference/soil_temperature.html">soil_temperature</a></span><span class="op">(</span>z_r.intervals<span class="op">=</span><span class="fl">12</span>,z_r<span class="op">=</span><span class="fl">1.5</span>, z<span class="op">=</span><span class="fl">4</span>, T_a<span class="op">=</span><span class="va">temp_vector</span>, u<span class="op">=</span><span class="va">wind_speed_vector</span>, Tsoil0<span class="op">=</span> <span class="fl">20</span>, z0<span class="op">=</span><span class="fl">0.02</span>, SSA<span class="op">=</span><span class="fl">0.7</span>, TimeIn<span class="op">=</span><span class="va">time_vector</span>, H<span class="op">=</span> <span class="va">solrad_vector</span>, water_content<span class="op">=</span><span class="fl">0.2</span>, air_pressure<span class="op">=</span><span class="fl">85</span>, rho_so<span class="op">=</span><span class="fl">1620</span>, shade<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="va">T_soil</span>, lty<span class="op">=</span><span class="st">"dotted"</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>

<span class="va">T_soil</span><span class="op">=</span> <span class="fu"><a href="../reference/soil_temperature.html">soil_temperature</a></span><span class="op">(</span>z_r.intervals<span class="op">=</span><span class="fl">12</span>,z_r<span class="op">=</span><span class="fl">1.5</span>, z<span class="op">=</span><span class="fl">6</span>, T_a<span class="op">=</span><span class="va">temp_vector</span>, u<span class="op">=</span><span class="va">wind_speed_vector</span>, Tsoil0<span class="op">=</span> <span class="fl">20</span>, z0<span class="op">=</span><span class="fl">0.02</span>, SSA<span class="op">=</span><span class="fl">0.7</span>, TimeIn<span class="op">=</span><span class="va">time_vector</span>, H<span class="op">=</span> <span class="va">solrad_vector</span>, water_content<span class="op">=</span><span class="fl">0.2</span>, air_pressure<span class="op">=</span><span class="fl">85</span>, rho_so<span class="op">=</span><span class="fl">1620</span>, shade<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="va">T_soil</span>, lty<span class="op">=</span><span class="st">"dotdash"</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, title<span class="op">=</span><span class="st">"soil depth interval"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dashed"</span>,<span class="st">"dotted"</span>,<span class="st">"dotdash"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<div class="section level2">
<h2 id="soil-specific-heat-and-conductivity">Soil specific heat and conductivity<a class="anchor" aria-label="anchor" href="#soil-specific-heat-and-conductivity"></a>
</h2>
<p>We can approximate soil specific heat, <span class="math inline">\(c_s\)</span>, as the weighted sum of the specific heats of soil constituents <span class="citation">(Campbell and Norman 2012)</span>: <span class="math inline">\(\rho_s c_s= rho_m c_m x_m + rho_o c_o x_o + rho_w c_w x_w,\)</span> where <span class="math inline">\(\rho_s\)</span> is the particle density of soil (bulk density), <span class="math inline">\(x\)</span> is the volume fraction, and the subscripts <span class="math inline">\(m\)</span>, <span class="math inline">\(o\)</span>,and <span class="math inline">\(w\)</span> stand for minerals, organic matter, and water, respectively. We provide a function to calculate soil specific heat given the volume fractions and <span class="math inline">\(\rho_s\)</span>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">1700</span>,<span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="../reference/soil_specific_heat.html">soil_specific_heat</a></span><span class="op">(</span>x_o<span class="op">=</span><span class="fl">0.01</span>, x_m<span class="op">=</span><span class="fl">0.6</span>, x_w<span class="op">=</span><span class="fl">0.2</span>, rho_so<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">1700</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"bulk density"</span> <span class="op">~</span> <span class="op">(</span><span class="va">kg</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="fl">3</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"soil specific heat"</span> <span class="op">~</span> <span class="op">(</span><span class="va">J</span> <span class="op">~</span> <span class="va">kg</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span> <span class="op">~</span> <span class="va">K</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MicroclimateTutorial_files/figure-html/unnamed-chunk-27-1.png" width="480"></p>
<p>Various methods of approximating soil thermal conductivity <span class="math inline">\(k_s\)</span> are reviewed in Boguslaw and Lukasz <span class="citation">(2004)</span>. We provide a function <code><a href="../reference/soil_conductivity.html">soil_conductivity()</a></code> to estimate <span class="math inline">\(k_s\)</span> using the methods of de Vries <span class="citation">(1963)</span>. The function calculates <span class="math inline">\(k_s\)</span> as the weighted average of the thermal conductivities <span class="math inline">\(k\)</span> of soil components <span class="math inline">\(i\)</span>: <span class="math display">\[k_s= \frac{\sum j_i k_i x_i}{\sum j_i x_i},\]</span> where quantity <span class="math inline">\(j_i\)</span> is the ratio of the average temperature gradient in the granules and the corresponding quantity in the medium (water or air): <span class="math display">\[j_i= \frac{1}{3} \sum_{p=a,b,c}[1+\left( \frac{k_i}{k_0}-1 \right)g_{p,i}]^{-1}, \]</span> where <span class="math inline">\(k_0\)</span> is the conductivity of the continuous medium in which soil particles are suspended (water or air) and <span class="math inline">\(g\)</span> is a shape factor for the soil particles. The soil particles are assumed to be ellipsoids with axes <span class="math inline">\(g_a\)</span>, <span class="math inline">\(g_b\)</span>, and <span class="math inline">\(g_c\)</span>, where <span class="math inline">\(g_a +g_b +g_c=1\)</span>. de Vries <span class="citation">(1952)</span> suggests <span class="math inline">\(g_a=g_b=0.125\)</span>. We provide the function as follows:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/soil_conductivity.html">soil_conductivity</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.10</span>,<span class="fl">0.40</span>,<span class="fl">0.11</span>,<span class="fl">0.01</span>,<span class="fl">0.2</span>, <span class="fl">0.18</span><span class="op">)</span>, lambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.10</span>,<span class="fl">0.40</span>,<span class="fl">0.11</span>,<span class="fl">0.01</span>,<span class="fl">0.2</span>, <span class="fl">0.18</span><span class="op">)</span>, g_a<span class="op">=</span><span class="fl">0.125</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.2336174</span></code></pre>
<p>#References</p>
<div id="refs" class="references">
<div id="ref-beckman1973thermal">
<p>Beckman, WA, John W Mitchell, and Warren Paul Porter. 1973. “Thermal Model for Prediction of a Desert Iguana’s Daily and Seasonal Behavior.”</p>
</div>
<div id="ref-boguslaw2004thermal">
<p>Boguslaw, Usowicz, and Usowicz Lukasz. 2004. “Thermal Conductivity of Soils—Comparison of Experimental Results and Estimation Methods.”</p>
</div>
<div id="ref-campbell2012introduction">
<p>Campbell, Gaylon S, and John Norman. 2012. <em>An Introduction to Environmental Biophysics</em>. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-de1952nonstationary">
<p>De Vries, DA. 1952. “A Nonstationary Method for Determining Thermal Conductivity of Soil in Situ.” <em>Soil Science</em> 73 (2): 83–90.</p>
</div>
<div id="ref-de1963physics">
<p>De Vries, DA, and WR Van Wijk. 1963. “Physics of Plant Environment.” <em>Environmental Control of Plant Growth</em> 5.</p>
</div>
<div id="ref-gates2012biophysical">
<p>Gates, David M. 2012. <em>Biophysical Ecology</em>. Courier Corporation.</p>
</div>
<div id="ref-kearney2017nichemapr">
<p>Kearney, Michael R, and Warren P Porter. 2017. “NicheMapR–an R Package for Biophysical Modelling: The Microclimate Model.” <em>Ecography</em> 40 (5): 664–74.</p>
</div>
<div id="ref-liu1960interrelationship">
<p>Liu, Benjamin YH, and Richard C Jordan. 1960. “The Interrelationship and Characteristic Distribution of Direct, Diffuse and Total Solar Radiation.” <em>Solar Energy</em> 4 (3): 1–19.</p>
</div>
<div id="ref-mccullough1971computing">
<p>McCullough, Edwin Charles, and Warren P Porter. 1971. “Computing Clear Day Solar Radiation Spectra for the Terrestrial Ecological Environment.” <em>Ecology</em> 52 (6): 1008–15.</p>
</div>
<div id="ref-porter1973behavioral">
<p>Porter, WP, JW Mitchell, WA Beckman, and CB DeWitt. 1973. “Behavioral Implications of Mechanistic Ecology.” <em>Oecologia</em> 13 (1): 1–54.</p>
</div>
<div id="ref-sellers1965physical">
<p>Sellers, William D. 1965. “Physical Climatology.” University of Chicago Press.</p>
</div>
<div id="ref-tham2010estimation">
<p>Tham, Y, T Muneer, and B Davison. 2010. “Estimation of Hourly Averaged Solar Irradiation: Evaluation of Models.” <em>Building Services Engineering Research and Technology</em> 31 (1): 9–25.</p>
</div>
<div id="ref-tracy1983estimating">
<p>Tracy, CR, KA Hammond, RA Lechleitner, WJ Smith II, DB Thompson, AD Whicker, and SC Williamson. 1983. “Estimating Clear-Day Solar Radiation: An Evaluation of Three Models.” <em>Journal of Thermal Biology</em> 8 (3): 247–51.</p>
</div>
<div id="ref-wong2001solar">
<p>Wong, LT, and WK Chow. 2001. “Solar Radiation Model.” <em>Applied Energy</em> 69 (3): 191–224.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lauren Buckley, Bryan Briones Ortiz, Aji John, Ofir Levy, Yutaro Sakairi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
